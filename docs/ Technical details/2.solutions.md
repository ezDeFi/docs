# Block sealing mechanism

The DCCS block sealing mechanism will be implemented as in following steps. Firstly, the sealers will be numbered from 0 to n − 1 (called “sealing-id”) randomly at the beginning of each epoch; in which, n is the number of registered “authorized-sealer” and is determined by the state of the governance smart contract at the canonical chain from checkpoint block number of the corresponding epoch. To ensure the randomness of “sealing-id”, the numbering is calculated by a hash, ξk, as following formula when starting a new epoch.
(1) ξk ≡ KEC(block, Λk)
block: is the canonical block number
from the checkpoint block number of
the epoch. a.k.a checkpoint block
number - 7
Λk: is the address that the NTF holder
has set as “authorized-sealer” in the
governance smart contract.
KEC: is the SHA-3 Keccak-512 hash
function of any input.

After that, the “sealing-id” of each authorized-sealer will be taken by the position of sealing hash, ξk, in the array (ξ0, ξ1, ..., ξn−1), ascending ordered by the sealing hash.

To ensure performance of the system, the “sealing-id” of the all authorized sealers will be snapshot only once from the smart contract state at the canonical chain from checkpoint block number of each epoch and stored in the local database as well as in lru cache of each node.

If sealing node is not in recent sealers. The node will determine whether it’s the in-turn sealer for the next block or not, according to the following formula:

(2) σk ≡ (ν − block) mod Π

ν: is the current block number that is being sealed.
block: is the canonical block number from checkpoint block number, of the current epoch.
Π: total number of authorized sealer reading from smart contract state at the canonical block from checkpoint block of the current epoch.

If the remainder σk equal to “sealing-id” of the node, then that node has in-turn sealer and seal block immediately with highest difficulty. Otherwise, nodes will wait a period of time, ψk, which is calculated by the formula:

(3) α = 001.387978000
(4) β = 000.002313279
(5) γ = 000.004626590
(6) δ = 499.999400000
(7) ψk ≡ ∑ ζk i=1 **floor** (α / (β ∗ i + γ) + δ)

The coefficients of the above formula are assumed as following. The sealing node having “sealing-id” equal to σk, calculated by formula (2), will have the priority to seal block before 400ms, the next sealing node will have the priority to seal block before 850ms, then 820ms,... till the final sealing node with approximately to 500ms. Its graph corresponds to the function y = a/(b∗x+c) + d 

To estimate values for the parameters, we use curve fitting method to find relatives coefficient in the website My Curve Fit with the variance 1 ≈ 1.

<!-- theme: info -->

> **Notice**
>
> 1R² is 1 minus the ratio of sum of the squares of the residuals divided by the sum of the squares of the differences between Y fit and the mean Y value.

[//]: # (add image of a graph )

The difficulty of sealing block for n sealers will be calculated in the formula (8) as below

(8) d(i) ≡ { n if sealer is in-turn n − ki if sealer is out-turn

ki is the relative position of out-turn sealer ith to the position of in-turn sealer in the current sealing order list.